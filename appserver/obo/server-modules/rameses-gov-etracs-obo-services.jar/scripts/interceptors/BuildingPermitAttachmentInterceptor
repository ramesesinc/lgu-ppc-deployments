import com.rameses.annotations.*;

class BuildingPermitAttachmentInterceptor {
	
	@Env
	def env;

	@DataContext("building_permit_attachment")
	def attachEm;

	@After(pattern="SysFileService.create", eval="#{args[0].param._schemaname == 'building_permit_attachment' }")
	public void beforeFileUpload(def evt) {
		def o = evt.args[0];
		def result = evt.result;
		def c = [objid: result.objid, appid: o.param.appid, parentid: o.param.parentid ] 
		c.file = [objid: result.objid];
		attachEm.create( c );
	}


	@Before(pattern="SysFileService.remove", eval="#{args[0].param._schemaname == 'building_permit_attachment' }")
	public void beforeRemoveUpload(def evt) {
		def o = evt.args[0];
		attachEm.delete( [objid: o.objid ] );
	}

}